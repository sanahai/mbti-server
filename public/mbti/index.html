<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBTI ì„±ê²© ë¶„ì„ - AI ì—°êµ¬ì†Œ</title>
    <style>
        /* ğŸ¨ ë””ìì¸ ìŠ¤íƒ€ì¼ (ì‚¬ë¼ì§€ì§€ ì•Šê²Œ ì—¬ê¸°ì— ë‹¤ ë„£ì—ˆìŠµë‹ˆë‹¤) */
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f4f6f8; margin: 0; padding: 20px; color: #333; text-align: center; }
        
        /* ê³µí†µ í—¤ë” */
        header { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px; max-width: 600px; margin-left: auto; margin-right: auto; }
        header a { text-decoration: none; color: inherit; }
        
        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .container { background: white; max-width: 600px; margin: 0 auto; padding: 40px 20px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); min-height: 400px; display: flex; flex-direction: column; justify-content: center; align-items: center; }

        /* ë²„íŠ¼ë“¤ */
        .btn-start { background-color: #6c5ce7; color: white; border: none; padding: 15px 40px; font-size: 1.2rem; border-radius: 30px; cursor: pointer; font-weight: bold; transition: 0.3s; margin-top: 20px; }
        .btn-start:hover { background-color: #5b4cc4; transform: scale(1.05); }

        .btn-option { width: 100%; max-width: 400px; padding: 18px; margin: 10px 0; border: 2px solid #eee; background: white; border-radius: 12px; font-size: 1rem; cursor: pointer; transition: 0.2s; color: #555; }
        .btn-option:hover { border-color: #6c5ce7; color: #6c5ce7; background-color: #f0f0ff; font-weight: bold; }

        /* ì§„í–‰ë°” */
        .progress-bar { width: 100%; height: 8px; background: #eee; border-radius: 4px; margin-bottom: 30px; overflow: hidden; }
        .progress-fill { height: 100%; background: #6c5ce7; width: 0%; transition: width 0.3s; }

        /* ìœ í‹¸ë¦¬í‹° */
        .hidden { display: none !important; }
        h1 { margin: 0 0 10px 0; color: #2d3436; }
        p { color: #636e72; line-height: 1.6; }
    </style>
</head>
<body>

    <header>
        <a href="/">
            <h3 style="margin:0;">ğŸ§  AI ì‹¬ë¦¬ ë¶„ì„ ì—°êµ¬ì†Œ</h3>
            <span style="font-size: 0.9rem; color: #6c5ce7; font-weight: bold;">ğŸ  í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</span>
        </a>
    </header>

    <div class="container">
        
        <div id="screen-start">
            <div style="font-size: 60px; margin-bottom: 20px;">ğŸ§©</div>
            <h1>MBTI ì„±ê²© ë¶„ì„</h1>
            <p>48ê°€ì§€ ì •ë°€ ë¬¸í•­ì„ í†µí•´<br>ë‚˜ì˜ ì§„ì§œ ì„±ê²©ì„ ì•Œì•„ë³´ì„¸ìš”.</p>
            <button class="btn-start" onclick="startTest()">ë¶„ì„ ì‹œì‘í•˜ê¸°</button>
        </div>

        <div id="screen-question" class="hidden" style="width: 100%;">
            <div class="progress-bar"><div id="progress" class="progress-fill"></div></div>
            <h2 id="question-text" style="margin-bottom: 30px;">ì§ˆë¬¸ì´ ì—¬ê¸°ì— ë‚˜ì˜µë‹ˆë‹¤</h2>
            <div id="options-box" style="display: flex; flex-direction: column; align-items: center;">
                </div>
        </div>

        <div id="screen-loading" class="hidden">
            <div style="font-size: 50px; animation: spin 1s infinite;">â³</div>
            <h2>AI ë¶„ì„ ì¤‘...</h2>
            <p>ì„œë²„ì—ì„œ ê²°ê³¼ë¥¼ ë°›ì•„ì˜¤ê³  ìˆìŠµë‹ˆë‹¤.<br>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
        </div>

        <div id="screen-result" class="hidden">
            <h2 style="color: #6c5ce7;">ë¶„ì„ ì™„ë£Œ!</h2>
            <div id="result-content" style="background: #f8f9fa; padding: 20px; border-radius: 15px; text-align: left; margin: 20px 0; white-space: pre-wrap;">
                ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
            </div>
            <button class="btn-start" onclick="location.reload()">ë‹¤ì‹œ í•˜ê¸°</button>
        </div>

    </div>

    <script>
        // ì§ˆë¬¸ ë°ì´í„° (ì¼ë‹¨ í…ŒìŠ¤íŠ¸ìš© 4ê°œë§Œ ë„£ì—ˆìŠµë‹ˆë‹¤. ì˜ ë˜ë©´ ëŠ˜ë¦¬ì„¸ìš”!)
        const questions = [
            { text: "íœ´ì¼ì—ëŠ” ì£¼ë¡œ ë¬´ì—‡ì„ í•˜ë©° ì‹œê°„ì„ ë³´ë‚´ë‚˜ìš”?", options: ["ì¹œêµ¬ë“¤ê³¼ ë§Œë‚˜ ë°–ì—ì„œ ë…¼ë‹¤ (E)", "ì§‘ì—ì„œ í˜¼ì ì‰¬ê±°ë‚˜ ì·¨ë¯¸ë¥¼ ì¦ê¸´ë‹¤ (I)"] },
            { text: "ë©í•˜ë‹ˆ ìƒìƒì´ë‚˜ ê³µìƒì— ë¹ ì§ˆ ë•Œê°€ ë§ë‚˜ìš”?", options: ["ìì£¼ ê·¸ëŸ°ë‹¤ (N)", "í˜„ì‹¤ì ì¸ ìƒê°ì„ ì£¼ë¡œ í•œë‹¤ (S)"] },
            { text: "ì¹œêµ¬ê°€ ìš°ìš¸í•´ì„œ ì „í™”ë¥¼ í–ˆìŠµë‹ˆë‹¤. ë‹¹ì‹ ì˜ ë°˜ì‘ì€?", options: ["ë¬´ìŠ¨ ì¼ì´ì•¼? í•´ê²°ì±…ì„ ì°¾ëŠ”ë‹¤ (T)", "ë§ì´ í˜ë“¤ì—ˆê² êµ¬ë‚˜.. ê³µê°í•œë‹¤ (F)"] },
            { text: "ì—¬í–‰ ê³„íšì„ ì§¤ ë•Œ ë‹¹ì‹ ì˜ ìŠ¤íƒ€ì¼ì€?", options: ["ë¶„ ë‹¨ìœ„ë¡œ ê¼¼ê¼¼í•˜ê²Œ ì§ ë‹¤ (J)", "í° í‹€ë§Œ ì§œê³  ê°€ì„œ ì •í•œë‹¤ (P)"] }
        ];

        let currentStep = 0;
        let answers = [];

        // í™”ë©´ ìš”ì†Œë“¤
        const screenStart = document.getElementById('screen-start');
        const screenQuestion = document.getElementById('screen-question');
        const screenLoading = document.getElementById('screen-loading');
        const screenResult = document.getElementById('screen-result');
        const questionText = document.getElementById('question-text');
        const optionsBox = document.getElementById('options-box');
        const progressBar = document.getElementById('progress');

        function startTest() {
            screenStart.classList.add('hidden');
            screenQuestion.classList.remove('hidden');
            showQuestion();
        }

        function showQuestion() {
            const q = questions[currentStep];
            
            // ì§„í–‰ë°”
            const percent = ((currentStep) / questions.length) * 100;
            progressBar.style.width = percent + '%';

            // í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            questionText.innerText = `Q${currentStep + 1}. ${q.text}`;

            // ë²„íŠ¼ ë§Œë“¤ê¸° (ê¸°ì¡´ ë²„íŠ¼ ì‚­ì œ í›„ ìƒˆë¡œ ìƒì„±)
            optionsBox.innerHTML = ''; 
            
            q.options.forEach(option => {
                const btn = document.createElement('button');
                btn.className = 'btn-option';
                btn.innerText = option;
                btn.onclick = () => nextStep(q.text, option); // í´ë¦­í•˜ë©´ ë‹¤ìŒìœ¼ë¡œ
                optionsBox.appendChild(btn);
            });
        }

        function nextStep(qText, aText) {
            answers.push({ question: qText, answer: aText });
            currentStep++;

            if (currentStep < questions.length) {
                showQuestion();
            } else {
                finishTest();
            }
        }

        async function finishTest() {
            screenQuestion.classList.add('hidden');
            screenLoading.classList.remove('hidden');

            try {
                // ì„œë²„ë¡œ ì „ì†¡ (ìƒëŒ€ ê²½ë¡œ ì‚¬ìš©)
                const res = await fetch('/analyze/mbti', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ answers: answers })
                });

                if (!res.ok) throw new Error("ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜");

                const data = await res.json();
                showResult(data);

            } catch (err) {
                console.error(err);
                alert("ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + err.message);
                location.reload();
            }
        }

        function showResult(data) {
            screenLoading.classList.add('hidden');
            screenResult.classList.remove('hidden');
            
            const content = document.getElementById('result-content');
            
            if (data.mbti) {
                content.innerHTML = `<h3 style='text-align:center; color:#6c5ce7; font-size:2rem;'>${data.mbti}</h3><hr>${data.desc || data.summary || JSON.stringify(data)}`;
            } else {
                content.innerText = JSON.stringify(data, null, 2);
            }
        }
    </script>

    <style>
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</body>
</html>
